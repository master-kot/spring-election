<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8"/>

    <title>Система голосования</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>

<body>

<div class="container">
    <div id="loginbox" sec:authorize="isAnonymous()">
        <div class="panel panel-info">
            <div class="panel-heading">
                <div class="panel-title">
                    <b>Пожалуйста войдите в систему, используя ваши учетные данные:</b>
                </div>
            </div>

            <div style="padding-top: 30px" class="panel-body">
                <form th:action="@{/authenticateTheUser}" method="POST">
                    <div style="margin-bottom: 25px" class="input-group">
                        <input type="text" name="username" placeholder="username" class="form-control">
                    </div>
                    <div style="margin-bottom: 25px" class="input-group">
                        <input type="password" name="password" placeholder="password" class="form-control">
                    </div>
                    <div style="margin-top: 10px" class="form-group">
                        <input type="submit" class="btn btn-success" value="Войти"/>
                    </div>
                </form>
            </div>

            <p>Подсказка: администратору (admin:admin) доступен просмотр количества голосов за кандидата</p>

            <div class="panel-heading">
                <div class="panel-title">
                    <b>Либо зарегистрируйте нового пользователя:</b>
                </div>
            </div>
            <div class="container">
                <form th:action="@{/user/create}" method="POST">
                    <div style="margin-bottom: 25px" class="input-group">
                        <input type="text" name="username" placeholder="username" class="form-control">
                    </div>
                    <div style="margin-bottom: 25px" class="input-group">
                        <input type="password" name="password" placeholder="password" class="form-control">
                    </div>
                    <div style="margin-top: 10px" class="form-group">
                        <input type="submit" class="btn btn-success" value="Создать" />
                        <input type="reset" class="btn btn-danger" value="Очистить" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div align="center" class="container" sec:authorize="isAuthenticated()">
        <div align="center">
            <form th:action="@{/logout}" method="POST">
                <input type="submit" class="btn btn-danger" value="Сменить пользователя" />
            </form>
        </div>
        <div>
            <h1>Мимимиметр</h1>
        </div>

        <table th:if="${candidates.size() == 2}">
            <tbody>
            <tr>
                <td height="50" colspan="2" align="center">Кто из них мимимишнее? Кликни по фотографии!</td>
            </tr>
            <tr>
                <td th:each="candidate : ${candidates}">
                    <table>
                        <tbody>
                        <tr height="300">
                            <td width="300" align="center">
                                <form th:action="@{/vote}" method="POST">
                                    <input type="hidden" name="id" placeholder="id" th:value="${candidate.getId()}">
                                    <input type="image" th:src="@{'/img/' + ${candidate.getPicture()}}" width="250" height="250" alt="Фото">
                                    <p><input type="submit" th:value="${candidate.getName()}" /></p>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tbody>
        </table>

        <table th:if="${candidates.size() > 2}">
            <tbody>
            <tr>
                <td height="80" colspan="3" align="center"><b>Топ 10</b><td/>
                <td sec:authorize="hasRole('ADMIN')"></td>
            </tr>
            <tr height="80" sec:authorize="hasRole('ADMIN')">
                <td width="50" align="center">Рейтинг</td>
                <td width="300" align="center">Фото кота</td>
                <td width="100" align="center">Имя кота</td>
                <td width="50" align="center" sec:authorize="hasRole('ADMIN')">Голосов</td>
            </tr>
            <tr height="260" th:each="candidate : ${candidates}" th:if="${candidates.indexOf(candidate) < 10}">
                <td width="50" align="center" th:text="${candidates.indexOf(candidate) + 1}"/>
                <td width="260" align="center"><img th:src="@{'/img/' + ${candidate.getPicture()}}" width="250" height="250" alt=""/><br></td>
                <td width="100" align="center" th:text="${candidate.getName()}"/>
                <td width="50" align="center" sec:authorize="hasRole('ADMIN')" th:text="${candidate.getVotes().size()}"/>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>